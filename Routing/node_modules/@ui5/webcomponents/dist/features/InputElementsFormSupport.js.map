{"version":3,"file":"InputElementsFormSupport.js","sourceRoot":"","sources":["../../src/features/InputElementsFormSupport.ts"],"names":[],"mappings":"AAAA,OAAO,EAAE,eAAe,EAAE,MAAM,kDAAkD,CAAC;AAenF,MAAM,sBAAsB,GAAG,CAAC,OAAqB,EAAE,EAAE;IACxD,IAAI,cAAc,GAAG,OAAO,CAAC,aAAa,CAAC;IAC3C,OAAO,cAAc,IAAI,cAAc,CAAC,OAAO,CAAC,WAAW,EAAE,KAAK,MAAM,EAAE;QACzE,cAAc,GAAG,cAAc,CAAC,aAAa,CAAC;KAC9C;IAED,IAAI,cAAc,YAAY,eAAe,EAAE;QAC9C,OAAO,cAAc,CAAC;KACtB;AACF,CAAC,CAAC;AAEF,MAAM,WAAW;IAChB;;;;;OAKG;IACH,MAAM,CAAC,qBAAqB,CAAC,OAAqB,EAAE,yBAAqD;QACxG,MAAM,gBAAgB,GAAG,CAAC,CAAC,OAAO,CAAC,IAAI,IAAI,OAAO,CAAC,QAAQ,CAAC;QAC5D,IAAI,WAAW,GAAG,OAAO,CAAC,aAAa,CAAC,8BAA8B,CAAqB,CAAC;QAC5F,IAAI,gBAAgB,IAAI,CAAC,WAAW,EAAE;YACrC,WAAW,GAAG,QAAQ,CAAC,aAAa,CAAC,OAAO,CAAC,CAAC;YAE9C,WAAW,CAAC,KAAK,CAAC,IAAI,GAAG,eAAe,CAAC;YACzC,WAAW,CAAC,KAAK,CAAC,QAAQ,GAAG,YAAY,CAAC;YAC1C,WAAW,CAAC,KAAK,CAAC,MAAM,GAAG,KAAK,CAAC;YACjC,WAAW,CAAC,KAAK,CAAC,QAAQ,GAAG,QAAQ,CAAC;YACtC,WAAW,CAAC,KAAK,CAAC,QAAQ,GAAG,UAAU,CAAC;YACxC,WAAW,CAAC,KAAK,CAAC,UAAU,GAAG,QAAQ,CAAC;YACxC,WAAW,CAAC,KAAK,CAAC,KAAK,GAAG,KAAK,CAAC;YAChC,WAAW,CAAC,KAAK,CAAC,MAAM,GAAG,GAAG,CAAC;YAC/B,WAAW,CAAC,YAAY,CAAC,UAAU,EAAE,IAAI,CAAC,CAAC;YAC3C,WAAW,CAAC,QAAQ,GAAG,OAAO,CAAC,QAAS,CAAC;YACzC,WAAW,CAAC,YAAY,CAAC,uBAAuB,EAAE,EAAE,CAAC,CAAC;YACtD,WAAW,CAAC,YAAY,CAAC,aAAa,EAAE,MAAM,CAAC,CAAC;YAEhD,WAAW,CAAC,gBAAgB,CAAC,SAAS,EAAE,GAAG,EAAE,CAAC,OAAO,CAAC,cAAc,EAAE,EAAE,KAAK,EAAE,CAAC,CAAC;YAEjF,WAAW,CAAC,IAAI,GAAG,aAAa,CAAC,CAAC,2GAA2G;YAC7I,OAAO,CAAC,WAAW,CAAC,WAAW,CAAC,CAAC;SACjC;QACD,IAAI,CAAC,gBAAgB,IAAI,WAAW,EAAE;YACrC,OAAO,CAAC,WAAW,CAAC,WAAW,CAAC,CAAC;SACjC;QAED,IAAI,gBAAgB,EAAE;YACrB,WAAW,CAAC,IAAI,GAAG,OAAO,CAAC,IAAK,CAAC;YACjC,CAAC,yBAAyB,IAAI,qBAAqB,CAAC,CAAC,OAAO,EAAE,WAAW,CAAC,CAAC;SAC3E;IACF,CAAC;IAED;;;;;;OAMG;IACH,MAAM,CAAC,mBAAmB,CAAC,OAAqB,EAAE,yBAAoD,EAAE,yBAAoD;QAC3J,MAAM,gBAAgB,GAAG,CAAC,CAAC,OAAO,CAAC,IAAI,CAAC;QACxC,IAAI,WAAW,GAAG,OAAO,CAAC,aAAa,CAAC,2CAA2C,CAAqB,CAAC;QAEzG,IAAI,gBAAgB,IAAI,CAAC,WAAW,EAAE;YACrC,WAAW,GAAG,QAAQ,CAAC,aAAa,CAAC,OAAO,CAAC,CAAC;YAC9C,WAAW,CAAC,IAAI,GAAG,MAAM,CAAC;YAC1B,WAAW,CAAC,YAAY,CAAC,uBAAuB,EAAE,EAAE,CAAC,CAAC;YACtD,WAAW,CAAC,IAAI,GAAG,aAAa,CAAC,CAAC,iDAAiD;YACnF,WAAW,CAAC,KAAK,CAAC,QAAQ,GAAG,UAAU,CAAC;YACxC,WAAW,CAAC,KAAK,CAAC,GAAG,GAAG,GAAG,CAAC;YAC5B,WAAW,CAAC,KAAK,CAAC,IAAI,GAAG,GAAG,CAAC;YAC7B,WAAW,CAAC,KAAK,CAAC,KAAK,GAAG,MAAM,CAAC;YACjC,WAAW,CAAC,KAAK,CAAC,MAAM,GAAG,MAAM,CAAC;YAClC,WAAW,CAAC,KAAK,CAAC,OAAO,GAAG,GAAG,CAAC;YAEhC,IAAI,OAAO,CAAC,QAAQ,EAAE;gBACrB,WAAW,CAAC,QAAQ,GAAG,IAAI,CAAC;aAC5B;YAED,WAAW,CAAC,gBAAgB,CAAC,QAAQ,EAAE,yBAAyB,CAAC,CAAC;YAElE,OAAO,CAAC,WAAW,CAAC,WAAW,CAAC,CAAC;SACjC;QAED,IAAI,CAAC,gBAAgB,IAAI,WAAW,EAAE;YACrC,OAAO,CAAC,WAAW,CAAC,WAAW,CAAC,CAAC;SACjC;QAED,IAAI,gBAAgB,EAAE;YACrB,WAAW,CAAC,IAAI,GAAG,OAAO,CAAC,IAAK,CAAC;YACjC,CAAC,yBAAyB,IAAI,qBAAqB,CAAC,CAAC,OAAO,EAAE,WAAW,CAAC,CAAC;SAC3E;IACF,CAAC;IAED,MAAM,CAAC,iBAAiB,CAAC,OAAqB;QAC7C,MAAM,WAAW,GAAG,sBAAsB,CAAC,OAAO,CAAC,CAAC;QACpD,IAAI,WAAW,EAAE;YAChB,IAAI,CAAC,WAAW,CAAC,aAAa,EAAE,EAAE;gBACjC,WAAW,CAAC,cAAc,EAAE,CAAC;gBAC7B,OAAO;aACP;YAED,oCAAoC;YACpC,MAAM,eAAe,GAAG,CAAC,WAAW,CAAC,aAAa,CAAC,IAAI,WAAW,CAAC,QAAQ,EAAE;gBAC5E,OAAO,EAAE,IAAI;gBACb,UAAU,EAAE,IAAI;gBAChB,SAAS,EAAE,OAAO;aAClB,CAAC,CAAC,CAAC;YAEJ,IAAI,eAAe,EAAE;gBACpB,OAAO;aACP;YAED,WAAW,CAAC,MAAM,EAAE,CAAC;SACrB;IACF,CAAC;IAED,MAAM,CAAC,gBAAgB,CAAC,OAAqB;QAC5C,MAAM,WAAW,GAAG,sBAAsB,CAAC,OAAO,CAAC,CAAC;QACpD,IAAI,WAAW,EAAE;YAChB,WAAW,CAAC,KAAK,EAAE,CAAC;SACpB;IACF,CAAC;CACD;AAED,MAAM,qBAAqB,GAAG,CAAC,OAAqB,EAAE,WAA6B,EAAE,EAAE;IACtF,WAAW,CAAC,QAAQ,GAAG,OAAO,CAAC,QAAS,CAAC;IACzC,WAAW,CAAC,KAAK,GAAG,OAAO,CAAC,KAAe,CAAC,CAAC,gFAAgF;AAC9H,CAAC,CAAC;AAEF,8FAA8F;AAC9F,eAAe,CAAC,aAAa,EAAE,WAAW,CAAC,CAAC;AAE5C,eAAe,WAAW,CAAC","sourcesContent":["import { registerFeature } from \"@ui5/webcomponents-base/dist/FeaturesRegistry.js\";\nimport type UI5Element from \"@ui5/webcomponents-base/dist/UI5Element.js\";\n\ninterface IFormElement extends UI5Element {\n\tvalue?: string | number,\n\tname?: string,\n\tdisabled?: boolean,\n\trequired?: boolean,\n\tmultiple?: boolean,\n\tchecked?: boolean,\n}\n\ntype NativeInputUpdateCallback = (element: IFormElement, nativeInput: HTMLInputElement) => void;\ntype NativeInputChangeCallback = (e: Event) => void;\n\nconst findNearestFormElement = (element: IFormElement) => {\n\tlet currentElement = element.parentElement;\n\twhile (currentElement && currentElement.tagName.toLowerCase() !== \"form\") {\n\t\tcurrentElement = currentElement.parentElement;\n\t}\n\n\tif (currentElement instanceof HTMLFormElement) {\n\t\treturn currentElement;\n\t}\n};\n\nclass FormSupport {\n\t/**\n\t * Syncs the native input element, rendered into the component's light DOM,\n\t * with the component's state.\n\t * @param { IFormElement} element - the component with form support\n\t * @param { NativeInputUpdateCallback } nativeInputUpdateCallback - callback to calculate the native input's \"disabled\" and \"value\" properties\n\t */\n\tstatic syncNativeHiddenInput(element: IFormElement, nativeInputUpdateCallback?: NativeInputUpdateCallback) {\n\t\tconst needsNativeInput = !!element.name || element.required;\n\t\tlet nativeInput = element.querySelector(\"input[data-ui5-form-support]\") as HTMLInputElement;\n\t\tif (needsNativeInput && !nativeInput) {\n\t\t\tnativeInput = document.createElement(\"input\");\n\n\t\t\tnativeInput.style.clip = \"rect(0 0 0 0)\";\n\t\t\tnativeInput.style.clipPath = \"inset(50%)\";\n\t\t\tnativeInput.style.height = \"1px\";\n\t\t\tnativeInput.style.overflow = \"hidden\";\n\t\t\tnativeInput.style.position = \"absolute\";\n\t\t\tnativeInput.style.whiteSpace = \"nowrap\";\n\t\t\tnativeInput.style.width = \"1px\";\n\t\t\tnativeInput.style.bottom = \"0\";\n\t\t\tnativeInput.setAttribute(\"tabindex\", \"-1\");\n\t\t\tnativeInput.required = element.required!;\n\t\t\tnativeInput.setAttribute(\"data-ui5-form-support\", \"\");\n\t\t\tnativeInput.setAttribute(\"aria-hidden\", \"true\");\n\n\t\t\tnativeInput.addEventListener(\"focusin\", () => element.getFocusDomRef()?.focus());\n\n\t\t\tnativeInput.slot = \"formSupport\"; // Needed for IE - otherwise input elements are not part of the real DOM tree and are not detected by forms\n\t\t\telement.appendChild(nativeInput);\n\t\t}\n\t\tif (!needsNativeInput && nativeInput) {\n\t\t\telement.removeChild(nativeInput);\n\t\t}\n\n\t\tif (needsNativeInput) {\n\t\t\tnativeInput.name = element.name!;\n\t\t\t(nativeInputUpdateCallback || copyDefaultProperties)(element, nativeInput);\n\t\t}\n\t}\n\n\t/**\n\t * Syncs the native file input element, rendered into the <code>ui5-file-uploader</code> component's light DOM,\n\t * with the <code>ui5-file-uploader</code> component's state.\n\t * @param { IFormFileElement} element - the component with form support\n\t * @param { NativeInputUpdateCallback } nativeInputUpdateCallback - callback to calculate the native input's \"disabled\" and \"value\" properties\n\t * @param { NativeInputChangeCallback } nativeInputChangeCallback - callback, added to native input's \"change\" event\n\t */\n\tstatic syncNativeFileInput(element: IFormElement, nativeInputUpdateCallback: NativeInputUpdateCallback, nativeInputChangeCallback: NativeInputChangeCallback) {\n\t\tconst needsNativeInput = !!element.name;\n\t\tlet nativeInput = element.querySelector(`input[type=\"file\"][data-ui5-form-support]`) as HTMLInputElement;\n\n\t\tif (needsNativeInput && !nativeInput) {\n\t\t\tnativeInput = document.createElement(\"input\");\n\t\t\tnativeInput.type = \"file\";\n\t\t\tnativeInput.setAttribute(\"data-ui5-form-support\", \"\");\n\t\t\tnativeInput.slot = \"formSupport\"; // Needed to visualize the input in the light dom\n\t\t\tnativeInput.style.position = \"absolute\";\n\t\t\tnativeInput.style.top = \"0\";\n\t\t\tnativeInput.style.left = \"0\";\n\t\t\tnativeInput.style.width = \"100%\";\n\t\t\tnativeInput.style.height = \"100%\";\n\t\t\tnativeInput.style.opacity = \"0\";\n\n\t\t\tif (element.multiple) {\n\t\t\t\tnativeInput.multiple = true;\n\t\t\t}\n\n\t\t\tnativeInput.addEventListener(\"change\", nativeInputChangeCallback);\n\n\t\t\telement.appendChild(nativeInput);\n\t\t}\n\n\t\tif (!needsNativeInput && nativeInput) {\n\t\t\telement.removeChild(nativeInput);\n\t\t}\n\n\t\tif (needsNativeInput) {\n\t\t\tnativeInput.name = element.name!;\n\t\t\t(nativeInputUpdateCallback || copyDefaultProperties)(element, nativeInput);\n\t\t}\n\t}\n\n\tstatic triggerFormSubmit(element: IFormElement) {\n\t\tconst formElement = findNearestFormElement(element);\n\t\tif (formElement) {\n\t\t\tif (!formElement.checkValidity()) {\n\t\t\t\tformElement.reportValidity();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// eslint-disable-next-line no-undef\n\t\t\tconst submitPrevented = !formElement.dispatchEvent(new SubmitEvent(\"submit\", {\n\t\t\t\tbubbles: true,\n\t\t\t\tcancelable: true,\n\t\t\t\tsubmitter: element,\n\t\t\t}));\n\n\t\t\tif (submitPrevented) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tformElement.submit();\n\t\t}\n\t}\n\n\tstatic triggerFormReset(element: IFormElement) {\n\t\tconst formElement = findNearestFormElement(element);\n\t\tif (formElement) {\n\t\t\tformElement.reset();\n\t\t}\n\t}\n}\n\nconst copyDefaultProperties = (element: IFormElement, nativeInput: HTMLInputElement) => {\n\tnativeInput.disabled = element.disabled!;\n\tnativeInput.value = element.value as string; // We do not explicitly convert to string to retain the current browser behavior\n};\n\n// Add form support to the global features registry so that Web Components can find and use it\nregisterFeature(\"FormSupport\", FormSupport);\n\nexport default FormSupport;\n\nexport {\n\tIFormElement,\n\tNativeInputChangeCallback,\n\tNativeInputUpdateCallback,\n};\n"]}