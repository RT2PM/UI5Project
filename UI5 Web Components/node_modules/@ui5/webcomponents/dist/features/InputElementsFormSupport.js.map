{"version":3,"file":"InputElementsFormSupport.js","sourceRoot":"","sources":["../../src/features/InputElementsFormSupport.ts"],"names":[],"mappings":"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","sourcesContent":["import { registerFeature } from \"@ui5/webcomponents-base/dist/FeaturesRegistry.js\";\nimport type UI5Element from \"@ui5/webcomponents-base/dist/UI5Element.js\";\n\ninterface IFormElement extends UI5Element {\n\tvalue?: string | number,\n\tname?: string,\n\tdisabled?: boolean,\n\trequired?: boolean,\n\tmultiple?: boolean,\n\tchecked?: boolean,\n}\n\ntype NativeFormElement = HTMLInputElement | HTMLTextAreaElement;\ntype NativeInputUpdateCallback = (element: IFormElement, nativeInput: NativeFormElement) => void;\ntype NativeInputChangeCallback = (e: Event) => void;\n\nconst findNearestFormElement = (element: IFormElement) => {\n\tlet currentElement = element.parentElement;\n\twhile (currentElement && currentElement.tagName.toLowerCase() !== \"form\") {\n\t\tcurrentElement = currentElement.parentElement;\n\t}\n\n\tif (currentElement instanceof HTMLFormElement) {\n\t\treturn currentElement;\n\t}\n};\n\nclass FormSupport {\n\t/**\n\t * Syncs the native input element, rendered into the component's light DOM,\n\t * with the component's state.\n\t * @param { IFormElement} element - the component with form support\n\t * @param { NativeInputUpdateCallback } nativeInputUpdateCallback - callback to calculate the native input's \"disabled\" and \"value\" properties\n\t */\n\tstatic syncNativeHiddenInput(element: IFormElement, nativeInputUpdateCallback?: NativeInputUpdateCallback) {\n\t\tconst needsNativeInput = !!element.name || element.required;\n\t\tconst nativeInput = element.querySelector<NativeFormElement>(\"input[data-ui5-form-support]\");\n\n\t\tif (needsNativeInput) {\n\t\t\tthis.syncNativeElement(element, nativeInput, nativeInputUpdateCallback);\n\t\t} else if (nativeInput) {\n\t\t\telement.removeChild(nativeInput);\n\t\t}\n\t}\n\n\t/**\n\t * Syncs the native textarea element, rendered into the component's light DOM,\n\t * with the component's state.\n\t * @param { IFormElement} element - the component with form support\n\t * @param { NativeInputUpdateCallback } nativeInputUpdateCallback - callback to calculate the native input's \"disabled\" and \"value\" properties\n\t */\n\tstatic syncNativeHiddenTextArea(element: IFormElement, nativeInputUpdateCallback?: NativeInputUpdateCallback) {\n\t\tconst needsNativeTextArea = !!element.name || element.required;\n\t\tconst nativeTextarea = element.querySelector<NativeFormElement>(\"textarea[data-ui5-form-support]\");\n\n\t\tif (needsNativeTextArea) {\n\t\t\tthis.syncNativeElement(element, nativeTextarea, nativeInputUpdateCallback, \"textarea\");\n\t\t} else if (nativeTextarea) {\n\t\t\telement.removeChild(nativeTextarea);\n\t\t}\n\t}\n\n\tstatic syncNativeElement(element: IFormElement, nativeElement: NativeFormElement | null, nativeInputUpdateCallback?: NativeInputUpdateCallback, nativeElementTagName = \"input\") {\n\t\tif (!nativeElement) {\n\t\t\tnativeElement = document.createElement(nativeElementTagName) as NativeFormElement;\n\n\t\t\tnativeElement.style.clip = \"rect(0 0 0 0)\";\n\t\t\tnativeElement.style.clipPath = \"inset(50%)\";\n\t\t\tnativeElement.style.height = \"1px\";\n\t\t\tnativeElement.style.overflow = \"hidden\";\n\t\t\tnativeElement.style.position = \"absolute\";\n\t\t\tnativeElement.style.whiteSpace = \"nowrap\";\n\t\t\tnativeElement.style.width = \"1px\";\n\t\t\tnativeElement.style.bottom = \"0\";\n\t\t\tnativeElement.setAttribute(\"tabindex\", \"-1\");\n\t\t\tnativeElement.required = element.required!;\n\t\t\tnativeElement.setAttribute(\"data-ui5-form-support\", \"\");\n\t\t\tnativeElement.setAttribute(\"aria-hidden\", \"true\");\n\n\t\t\tnativeElement.addEventListener(\"focusin\", () => element.getFocusDomRef()?.focus());\n\n\t\t\tnativeElement.slot = \"formSupport\"; // Needed for IE - otherwise input elements are not part of the real DOM tree and are not detected by forms\n\t\t\telement.appendChild(nativeElement);\n\t\t}\n\n\t\tnativeElement.name = element.name!;\n\t\t(nativeInputUpdateCallback || copyDefaultProperties)(element, nativeElement);\n\t}\n\n\t/**\n\t * Syncs the native file input element, rendered into the <code>ui5-file-uploader</code> component's light DOM,\n\t * with the <code>ui5-file-uploader</code> component's state.\n\t * @param { IFormFileElement} element - the component with form support\n\t * @param { NativeInputUpdateCallback } nativeInputUpdateCallback - callback to calculate the native input's \"disabled\" and \"value\" properties\n\t * @param { NativeInputChangeCallback } nativeInputChangeCallback - callback, added to native input's \"change\" event\n\t */\n\tstatic syncNativeFileInput(element: IFormElement, nativeInputUpdateCallback: NativeInputUpdateCallback, nativeInputChangeCallback: NativeInputChangeCallback) {\n\t\tconst needsNativeInput = !!element.name;\n\t\tlet nativeInput = element.querySelector<HTMLInputElement>(`input[type=\"file\"][data-ui5-form-support]`);\n\n\t\tif (needsNativeInput && !nativeInput) {\n\t\t\tnativeInput = document.createElement(\"input\");\n\t\t\tnativeInput.type = \"file\";\n\t\t\tnativeInput.setAttribute(\"data-ui5-form-support\", \"\");\n\t\t\tnativeInput.slot = \"formSupport\"; // Needed to visualize the input in the light dom\n\t\t\tnativeInput.style.position = \"absolute\";\n\t\t\tnativeInput.style.top = \"0\";\n\t\t\tnativeInput.style.left = \"0\";\n\t\t\tnativeInput.style.width = \"100%\";\n\t\t\tnativeInput.style.height = \"100%\";\n\t\t\tnativeInput.style.opacity = \"0\";\n\n\t\t\tif (element.multiple) {\n\t\t\t\tnativeInput.multiple = true;\n\t\t\t}\n\n\t\t\tnativeInput.addEventListener(\"change\", nativeInputChangeCallback);\n\n\t\t\telement.appendChild(nativeInput);\n\t\t}\n\n\t\tif (!needsNativeInput && nativeInput) {\n\t\t\telement.removeChild(nativeInput);\n\t\t}\n\n\t\tif (needsNativeInput) {\n\t\t\tnativeInput!.name = element.name!;\n\t\t\t(nativeInputUpdateCallback || copyDefaultProperties)(element, nativeInput!);\n\t\t}\n\t}\n\n\tstatic triggerFormSubmit(element: IFormElement) {\n\t\tconst formElement = findNearestFormElement(element);\n\t\tif (formElement) {\n\t\t\tif (!formElement.checkValidity()) {\n\t\t\t\tformElement.reportValidity();\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\t// eslint-disable-next-line no-undef\n\t\t\tconst submitPrevented = !formElement.dispatchEvent(new SubmitEvent(\"submit\", {\n\t\t\t\tbubbles: true,\n\t\t\t\tcancelable: true,\n\t\t\t\tsubmitter: element,\n\t\t\t}));\n\n\t\t\tif (submitPrevented) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tformElement.submit();\n\t\t}\n\t}\n\n\tstatic triggerFormReset(element: IFormElement) {\n\t\tconst formElement = findNearestFormElement(element);\n\t\tif (formElement) {\n\t\t\tformElement.reset();\n\t\t}\n\t}\n}\n\nconst copyDefaultProperties = (element: IFormElement, nativeInput: NativeFormElement) => {\n\tnativeInput.disabled = element.disabled!;\n\tnativeInput.value = element.value as string; // We do not explicitly convert to string to retain the current browser behavior\n};\n\n// Add form support to the global features registry so that Web Components can find and use it\nregisterFeature(\"FormSupport\", FormSupport);\n\nexport default FormSupport;\n\nexport {\n\tIFormElement,\n\tNativeFormElement,\n\tNativeInputChangeCallback,\n\tNativeInputUpdateCallback,\n};\n"]}